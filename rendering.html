<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/reset.css">
    <style>

        .go-btn {
            position: absolute;
            right: 0;
            top: 0;
        }
    </style>
</head>
<body style="position: fixed; left: 0px; right: 0px; top: 0px; bottom: 0px; overflow: hidden; margin: 0; padding: 0; height: 100%">
    <video class="video" src="video/solar.mov" style="position: absolute; width: 100px; height: 100px; " autoplay muted loop></video>
    <canvas id="canvas" style="width: 100%; height: 100%; padding: 0;margin: 0;"></canvas>
    <button type="button" class="go-btn">
        <a href="index.html">이동하기</a>
    </button>

    <script>





        const canvas = document.querySelector('#canvas');
        const c = canvas.getContext("2d");

        let img = new Image();
        img.src = "img/detail/transparent-logo.png";

        c.textAlign = 'center';
        c.fillText('비디오 로딩 중..', 300, 200);

        const videoElem = document.querySelector('.video');

        videoElem.addEventListener('canplaythrough', render);

        function render() {
            c.drawImage(videoElem, canvas.clientWidth/2 - 300, canvas.clientHeight/2 - 200, 600, 400);
            requestAnimationFrame(render);
        }
        let w;
        let h;
        const setCanvasExtents = () => {
            w = document.body.clientWidth;
            h = document.body.clientHeight;
            canvas.width = w;
            canvas.height = h;

        }
        setCanvasExtents();
        window.onresize = () => {
            setCanvasExtents();
        }

        const makeStars = (count) => {
            const out = [];
            for(let i = 0; i < count; i++) {
                const s = {
                    x: Math.random()*1600 - 800,
                    y: Math.random()*900 -450,
                    z: Math.random()*1000
                };
                out.push(s);
            }
            return out;
        }
        let stars = makeStars(10000);

        const clear = () => {
            let grd = c.createLinearGradient(0,0,0, canvas.height);
            grd.addColorStop(0, "#131138");
            grd.addColorStop(0.5,"#23196f")
            grd.addColorStop(1, "#131138");
            c.fillStyle = grd;
            c.fillRect(0, 0, canvas.width, canvas.height);
        };

        const putPixel = (x, y, brightness,i) => {
            const r = Math.random() * 255;
            const g = Math.random() * 255;

            const intensity = brightness*255;

            const b = Math.random() * 255;
            // const rgb = `rgb(${r},${g},${b})`;
            const rgb = `rgb(${intensity},${intensity},${intensity}`;

            c.fillStyle = rgb;

            c.beginPath();
            c.arc(x, y, 1, 0, Math.PI * 2);
            c.fill();
            c.closePath();


        };

        const moveStars = (distance) => {
            const count = stars.length;
            for( let i = 0; i < count; i++) {
                const s = stars[i];
                s.z -= distance;
                while(s.z <= 1) {
                    s.z+=1000;
                }
            }
        };


        let prevTime;
        const init = time => {

            prevTime = time;
            requestAnimationFrame(tick);
        }
        requestAnimationFrame(init);

        const tick = time => {
            let elapsed = time - prevTime;
            prevTime = time;
            moveStars(elapsed*0.1);
            clear();
            const cx = w/2;
            const cy = h/2;

            c.drawImage(img, cx - 300, 50, 600, 150);




            const count = stars.length;
            for (var i = 0; i < count; i++) {
                const star = stars[i];


                const x = cx + star.x/(star.z * 0.001);
                const y = cy + star.y/(star.z * 0.001);



                if (x < 0 || x >= w || y < 0 || y >= h){
                    continue;
                }

                const d = (star.z/1000.0);
                const b = 1-d*d;

                putPixel(x, y, b, i);

            }
            requestAnimationFrame(tick);
        };

    </script>
</body>
</html>